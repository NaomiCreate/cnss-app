<!-- https://getbootstrap.com/docs/4.0/components/card/ -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


<div class="card" id="btn-add-section">
    <button class="collapse-btn" type="button" data-toggle="collapse" data-target="#collapseAddContact"
    aria-expanded="false" aria-controls="collapseAddContact" (click)="collapseAddContact()">
        {{addSection.showAddContactBtnTitle}}
        <span class="material-icons">{{addSection.icon}}</span>
    </button>
</div>
<div class="card text-center" id="add-section">

    <div class="collapse" id="collapseAddContact">

        <h5 class="card-title">
            Add new contact
        </h5>
        
        <div>
            <!-- user error -->
            <p *ngIf="errorMessageNewContact.length > 0" class="text-danger" name="error_message">
                {{errorMessageNewContact}}
            </p>
            <!-- firebase error handle -->
            <p *ngIf="error.message.length > 0" class="text-danger" name="error_message">{{error.message}}</p>
            <!-- the data registered in firebase -->
            <p *ngIf="messageNewContact.length > 0" class="text-info" name="message">{{messageNewContact}}</p>
        </div>
        <div class="card-body">
            <input type="text" class="from-control" name="input" [(ngModel)]="new_contact.firstName"
                placeholder="First name" required>
            <br />
            <input type="text" class="from-control" name="input" [(ngModel)]="new_contact.lastName"
                placeholder="Last name" required>
            <br />
            <input type="email" class="from-control" name="input" [(ngModel)]="new_contact.email" placeholder="Email"
                required>
            <br />


            <p>Share your history with this contact?</p>
            <input type="radio" id="share" name="shareOrNot" [(ngModel)]="new_contact.shareHistory" [value]="true" />
            <label>Yes</label>
            <input type="radio" id="notShare" name="shareOrNot" [(ngModel)]="new_contact.shareHistory"
                [value]="false" />
            <label>No </label>
            <br />


            <button class="btn btn-primary" type="submit" (click)="addContact(new_contact.email)">Send request</button>
        </div>
    </div>
</div>


<div class="container-content">
    <div class="error-msg">
        <!-- user error -->
        <p *ngIf="errorMessageEditContact.length > 0" class="text-danger">{{errorMessageEditContact}}</p>
        <!-- firebase error handle -->
        <p *ngIf="error.message.length > 0" class="text-danger">{{error.message}}</p>
        <!-- the data registered in firebase -->
        <p *ngIf="messageEditContact.length > 0" class="text-info">{{messageEditContact}}</p>
    </div>

    <div [ngSwitch]="contacts_state">
        <div *ngSwitchCase="state.Accept">

            <div *ngFor="let contact of contacts">
                <div *ngIf="!contact.inEdit; else elseBlock">
                    <div class="card" id="contacts">
                        <button class="btn-delete" (click)="DeleteContact(contact.email)"><i class="fa fa-trash"></i></button>
                        <h5 class="card-title text-center">{{contact.firstName}} {{contact.lastName}}</h5>
                        <!-- <button class="btn-delete" (click)="DeleteRequest(contact.email)"><i class="fa fa-trash"></i></button> -->
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><label>First name</label><br>{{contact.firstName}}</li>
                            <li class="list-group-item"><label>Last name</label><br>{{contact.lastName}}</li>
                            <li class="list-group-item"><label>Email</label><br>{{contact.email}}</li>
                            <li class="list-group-item"><label>Phone</label><br>{{contact.phone}}</li>
                            <li class="list-group-item"><label>Share history</label><br>{{contact.shareHistory}}</li>
                            <!-- <li class="list-group-item"><label>Confirmed</label><br>{{contact.confirmed}}</li> -->
                        </ul>
                        <button (click)="editRecord(contact)" class="btn-edit">Edit</button>         
                    </div>
                </div>
                <ng-template #elseBlock>
                    <div class="card" id="contacts">
                        <button class="btn-delete" (click)="DeleteContact(contact.email)"><i class="fa fa-trash"></i></button>
                        <h5 class="card-title text-center">{{contact.firstName}} {{contact.lastName}}</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><label>First name</label><br>    
                                <input type="text" id="first_name" [(ngModel)]="contact.editFirstName" class="edit-from-control" placeholder="First name">
                            </li>
                            <li class="list-group-item"><label>Last name</label><br>
                                <input type="text" id="last_name" [(ngModel)]="contact.editLastName" class="edit-from-control" placeholder="Last name">
                            </li>
                            <li class="list-group-item"><label>Email</label><br>{{contact.email}}</li>
                            <li class="list-group-item"><label>Phone</label><br>{{contact.phone}}</li>
                            <li class="list-group-item"><label>Share history</label><br>
                                <div>
                                    <input type="radio" id="editShare" name="{{'editShare' + contact.email}}"
                                        [(ngModel)]="contact.editShareHistory" [value]="true" />
                                    <label>Yes</label><br>
                                    <input type="radio" id="editShare" name="{{'editShare' + contact.email}}"
                                        [(ngModel)]="contact.editShareHistory" [value]="false" />
                                    <label>No</label><br>
                                </div>
                            </li>
                            <!-- <li class="list-group-item"><label>Confirmed</label><br>{{contact.confirmed}}</li> -->
                        </ul>
                        <span>
                            <button (click)="contact.inEdit = false; cleanMessages();">Cancel</button>
                            <button style="float: right;" (click)="updateRecord(contact)">Update Card</button>
                        </span>
                    </div>
                </ng-template>
            </div>

            <div *ngFor="let request of requests">
                <div *ngIf="!request.inEdit; else elseBlock">
                    <div class="card" id="requests">
                        <button class="btn-delete" (click)="DeleteRequest(request.email)"><i class="fa fa-trash"></i></button>
                        <h5 class="card-title text-center">{{request.firstName}} {{request.lastName}}</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><label>First name</label><br>{{request.firstName}}</li>
                            <li class="list-group-item"><label>Last name</label><br>{{request.lastName}}</li>
                            <li class="list-group-item"><label>Email</label><br>{{request.email}}</li>
                            <li class="list-group-item"><label>Phone</label><br>{{request.phone}}</li>
                            <li class="list-group-item"><label>Share history</label><br>{{request.shareHistory}}</li>
                            <!-- <li class="list-group-item"><label>Confirmed</label><br>{{request.confirmed}}</li> -->
                        </ul>
                        <button (click)="editRecord(request)" class="btn-edit">Edit</button>         
                    </div>
                </div>
                <ng-template #elseBlock>
                    <div class="card" id="requests">

                        <button class="btn-delete" (click)="DeleteRequest(request.email)"><i class="fa fa-trash"></i></button>
                        <h5 class="card-title text-center">{{request.firstName}} {{request.lastName}}</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><label>First name</label><br>
                                <input type="text" id="first_name" [(ngModel)]="request.editFirstName" class="edit-from-control" placeholder="First name">
                            </li>
                            <li class="list-group-item"><label>Last name</label><br>
                                <input type="text" id="last_name" [(ngModel)]="request.editLastName" class="edit-from-control" placeholder="Last name">
                            </li>
                            <li class="list-group-item"><label>Email</label><br>{{request.email}}</li>
                            <li class="list-group-item"><label>Phone</label><br>{{request.phone}}</li>
                            <li class="list-group-item"><label>Share history</label><br>
                                <div>
                                    <input type="radio" id="editShare" name="{{'editShare' + request.email}}"
                                        [(ngModel)]="request.editShareHistory" [value]="true" />
                                    <label>Yes</label><br>
                                    <input type="radio" id="editShare" name="{{'editShare' + request.email}}"
                                        [(ngModel)]="request.editShareHistory" [value]="false" />
                                    <label>No</label><br>
                                </div>
                            </li>
                            <!-- <li class="list-group-item"><label>Confirmed</label><br>{{request.confirmed}}</li> -->
                        </ul>
                        <span>
                            <button (click)="request.inEdit = false; cleanMessages();">Cancel</button>
                            <button style="float: right;" (click)="updateRecord(request)">Update Card</button>
                        </span>
                    </div>
                </ng-template>
            </div>

            <br />
            <br />
            <br />

        </div>
        <div *ngSwitchCase="state.Deny">Currently, you have no contacts in your contact list</div>
        <div *ngSwitchDefault>Loading, please wait...</div>
    </div>

</div>